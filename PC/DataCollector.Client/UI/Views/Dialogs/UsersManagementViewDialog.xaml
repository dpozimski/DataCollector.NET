<UserControl
    x:Class="DataCollector.Client.UI.Views.Dialogs.UsersManagementViewDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:DatabaseModels="clr-namespace:DataCollector.Client.DataAccess.Models;assembly=DataCollector.Client.DataAccess"
    xmlns:converters="clr-namespace:DataCollector.Client.UI.Converters"
    xmlns:core="clr-namespace:System;assembly=mscorlib"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extensions="clr-namespace:DataCollector.Client.UI.Extensions"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:validation="clr-namespace:DataCollector.Client.UI.ValidationRules"
    xmlns:wpf="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
    Width="720"
    Height="540"
    FontFamily="{StaticResource DefaultFont}"
    TextElement.Foreground="{DynamicResource MaterialDesignBody}">
    <wpf:DialogHost Identifier="{Binding RootDialogId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid.Resources>
                <converters:IsNullToVisiblityConverter x:Key="IsNullToVisiblityConverter" />
                <converters:EnumToStringDescription x:Key="EnumToDescriptionConverter" />
            </Grid.Resources>

            <GroupBox
                Grid.Column="0"
                Margin="10"
                Style="{DynamicResource MaterialDesignCardGroupBox}"
                Header="Użytkownicy">
                <GroupBox.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <wpf:PackIcon Kind="Account" />
                            <TextBlock
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                Style="{StaticResource MaterialDesignSubheadingTextBlock}"
                                Text="{Binding}" />
                        </StackPanel>
                    </DataTemplate>
                </GroupBox.HeaderTemplate>
                <DataGrid
                    Margin="0,8,0,0"
                    wpf:DataGridAssist.CellPadding="13 8 8 8"
                    wpf:DataGridAssist.ColumnHeaderPadding="8"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserSortColumns="True"
                    ItemsSource="{Binding Users}"
                    SelectedItem="{Binding SelectedUser, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectionMode="Extended"
                    SelectionUnit="FullRow">
                    <DataGrid.RowDetailsTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Vertical" Margin="16">
                                <TextBlock Margin="0,0,0,10" TextAlignment="Left" FontWeight="Bold" Text="Historia logowania użytkownika"/>
                                <DataGrid
                                    MaxHeight="250"
                                    wpf:DataGridAssist.CellPadding="13 8 8 8"
                                    wpf:DataGridAssist.ColumnHeaderPadding="8"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    CanUserSortColumns="True"
                                    ItemsSource="{Binding LoginHistory, Mode=OneTime, UpdateSourceTrigger=PropertyChanged}"
                                    SelectionMode="Extended"
                                    SelectionUnit="FullRow">
                                    <DataGrid.Columns>
                                        <materialDesign:MaterialDataGridTextColumn
                                            Binding="{Binding LoginTimeStamp, StringFormat=dd.MM.yy HH:mm:ss}"
                                            Header="Rozpoczęcie sesji"
                                            IsReadOnly="True" />
                                        <materialDesign:MaterialDataGridTextColumn
                                            Binding="{Binding LogoutTimeStamp}"
                                            Header="Zakończenie sesji"
                                            IsReadOnly="True" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </DataTemplate>
                    </DataGrid.RowDetailsTemplate>
                    <DataGrid.Columns>
                        <materialDesign:MaterialDataGridTextColumn
                            Binding="{Binding Login}"
                            Header="Login"
                            IsReadOnly="True" />
                        <materialDesign:MaterialDataGridTextColumn
                            Binding="{Binding FirstName}"
                            Header="Imię"
                            IsReadOnly="True" />
                        <materialDesign:MaterialDataGridTextColumn
                            Binding="{Binding LastName}"
                            Header="Nazwisko"
                            IsReadOnly="True" />
                        <materialDesign:MaterialDataGridTextColumn
                            Binding="{Binding Role, Converter={StaticResource EnumToDescriptionConverter}}"
                            Header="Uprawnienie"
                            IsReadOnly="True" />
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <GroupBox
                Grid.Column="1"
                Margin="10"
                Style="{DynamicResource MaterialDesignCardGroupBox}"
                Header="Zarządzanie">
                <GroupBox.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <wpf:PackIcon Kind="AccountSettings" />
                            <TextBlock
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                Style="{StaticResource MaterialDesignSubheadingTextBlock}"
                                Text="{Binding}" />
                        </StackPanel>
                    </DataTemplate>
                </GroupBox.HeaderTemplate>

                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">

                    <StackPanel.Resources>
                        <Style BasedOn="{StaticResource {x:Type Button}}" TargetType="Button">
                            <Setter Property="Margin" Value="5" />
                        </Style>
                    </StackPanel.Resources>

                    <Button Command="{Binding AddUserCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="AccountPlus" />
                            <TextBlock
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                Text="Dodaj" />
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding DeleteUserCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="AccountMinus" />
                            <TextBlock
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                Text="Usuń" />
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding EditUserCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="AccountConvert" />
                            <TextBlock
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                Text="Zmień" />
                        </StackPanel>
                    </Button>

                    <Button Command="{x:Static wpf:DialogHost.CloseDialogCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Close" />
                            <TextBlock
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                Text="Zamknij" />
                        </StackPanel>
                    </Button>

                </StackPanel>
            </GroupBox>
        </Grid>
    </wpf:DialogHost>
</UserControl>
